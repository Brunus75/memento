----------** MEMENTO LINUX **----------

.. signifie « dossier précédent »
. signifie « dossier dans lequel je me trouve »
Tab pour l'autocomplétion ! 

I) LA COMMANDE

Mode (vraie) Console = ctrl+alt+f2 = ouvrir / ctrl+alt+f1 = sortir
pour taper des chiffres dans la console : shift+chiffres au-dessus des lettres
(ne pas utiliser le pavé numérique)
(!) login en minuscule

Un « fichier caché » sous Linux est un fichier qui commence par un point.
Ce sont en général des fichiers de configuration de programmes.

Autocomplétion de commande : taper le début de la commande puis taper 2 fois Tab (->| à gauche du clavier)
ou s'il n'y a qu'une commande associée, le mot + 1 fois Tab (ex. dat => date)

Quelques raccourcis à connaître quand une liste s'affiche page par page :
• tapez Espace pour passer à la page suivante ;
• tapez Entrée pour aller à la ligne suivante ;
• tapez q pour arrêter la liste ;

Historique des commandes avec la flèche haut du pavé numérique ou la commande history
Ctrl + R : rechercher une commande tapée avec quelques lettres

◘ Raccourcis claviers pratiques

• Ctrl + L : efface le contenu de la console (comme la commande clear)
• Ctrl + D : envoie le message EOF (fin de fichier) à la console (commande exit)
• Shift + PgUp (flèche haut barrée de 3 barres) : vous permet de « remonter » dans les messages envoyés par la console. En mode graphique, la molette de la souris accomplit aussi très bien cette action
• Shift + PgDown : pareil, mais pour redescendre

Longue commande
• Ctrl + A : ramène le curseur au début de la commande (comme touche Origin, flèche à droite du bouton Fin)
• Ctrl + E : ramène le curseur à la fin de la ligne de commandes (comme touche Fin)
• Ctrl + U : supprime tout ce qui se trouve à gauche du curseur. Si celui-ci est situé à la fin de la ligne, cette dernière sera donc supprimée.
• Ctrl + K : supprime tout ce qui se trouve à droite du curseur. S'il est situé au début de la ligne, celle-ci sera donc totalement supprimée.
• Ctrl + W : supprime le premier mot situé à gauche du curseur. Un « mot » est séparé par des espaces ; on s'en sert en général pour supprimer le paramètre situé à gauche du curseur.
• Ctrl + Y : si vous avez supprimé du texte avec une des commandes Ctrl + U, Ctrl + K ou Ctrl + W qu'on vient de voir, alors le raccourci Ctrl + Y « collera » le texte que vous venez de supprimer. C'est donc un peu comme un couper-coller.


II) La structure des dossiers et fichiers

◘ Organisation des dossiers

Au lieu de séparer chaque disque dur, lecteur CD, lecteur de disquettes, lecteur de carte mémoire… Linux place en gros tout au même endroit.
Deux types de fichiers :
• classiques (.txt)
• spéciaux (représentent qqc : ex. lecteur CD)
Sous Linux, il n'y a qu'une et une seule racine : « / ».
Architecture des dossiers :
• C:\Program Files\Winzip (Windows)
• /usr/bin/ (linux)

◘ pwd & which : où… où suis-je ?

• pwd : afficher le dossier actuel
mateo21@mateo21-desktop:~$ = /home/mateo21 (~ = home, dossier perso)
mateo21@mateo21-desktop:~$ pwd
/home/mateo21

• which : connaître l'emplacement d'une commande
chaque commande sous Linux correspond à un programme. Ainsi, pwd est un programme.
Une commande n'est rien d'autre qu'un programme qu'on peut appeler n'importe quand et n'importe où dans la console.
La commande which prend un paramètre : le nom de la commande dont vous voulez connaître l'emplacement.
mateo21@mateo21-desktop:~$ which pwd
/bin/pwd
(!) les programmes sous Linux ne possèdent en général pas d'extension (contrairement à Windows où l'extension utilisée est en général .exe)

◘ ls : lister les fichiers et dossiers

Les dossiers apparaissent en bleu foncé. En bleu clair : raccourci vers un dossier qui se trouve en fait ailleurs sur le disque.

• -a : afficher tous les fichiers et dossiers cachés
mateo21@mateo21-desktop:~$ ls -a

• -F : indique le type d'élément
mateo21@mateo21-desktop:~$ ls -F
Desktop/  Examples@  images/  log/  tutos/

• -l : liste détaillée
mateo21@mateo21-desktop:~$ ls -l
total 16
drwxr-xr-x 2 mateo21 mateo21 4096 2007-09-24 17:22 Desktop

• -h : afficher la taille en Ko, Mo, Go…

• -t : trier par date de dernière modification
En pratique, je combine -t avec -r qui renverse l'ordre d'affichage des fichiers.
Je combine un peu tous les paramètres que l'on vient de voir, ce qui donne un beau ls -larth

◘ cd: changer de dossier

la commande cd (Change Directory) ne prend pas plein de paramètres mais juste un seul : le nom du dossier dans lequel vous souhaitez aller.
Si on veut aller à la racine, il suffit de taper cd / :
mateo21@mateo21-desktop:~$ cd /
mateo21@mateo21-desktop:/$ pwd
/
Allons dans le sous-dossier usr :
mateo21@mateo21-desktop:/$ cd usr
mateo21@mateo21-desktop:/usr$ ls -F
bin/  games/  include/  lib/  local/  sbin/  share/  src/  X11R6/
mateo21@mateo21-desktop:/usr$ cd games
mateo21@mateo21-desktop:/usr/games$
Pour revenir au dossier précédent, aussi appelé dossier parent, c'est-à-dire /usr :
mateo21@mateo21-desktop:/usr/games$ cd ..
mateo21@mateo21-desktop:/usr$
Si on avait voulu reculer de deux dossiers parents, on aurait écrit../..(« reviens en arrière, puis reviens en arrière »). Cela nous aurait ramené à la racine :
mateo21@mateo21-desktop:/usr/games$ cd ../..
mateo21@mateo21-desktop:/$

Il y a en fait deux façons de changer de dossier : en indiquant un chemin relatif, ou en indiquant un chemin absolu.

• chemin relatif 
on utilise un chemin relatif, c'est-à-dire relatif au dossier actuel

• chemin absolu
Un chemin absolu commence toujours par la racine (/). Vous devez ensuite faire la liste des dossiers dans lesquels vous voulez entrer. Par exemple, supposons que je sois dans/home/mateo21et que je souhaite aller dans/usr/games. Avec un chemin absolu :
mateo21@mateo21-desktop:~$ cd /usr/games
mateo21@mateo21-desktop:/usr/games$
Si on avait voulu faire la même chose à coup de chemin relatif, il aurait fallu écrire :
mateo21@mateo21-desktop:~$ cd ../../usr/games/
mateo21@mateo21-desktop:/usr/games$
Ce qui signifie « reviens en arrière (donc dans/home) puis reviens en arrière (donc dans/), puis va en avant dans usr, puis va en avant dans games ».

• retour au répertoire home/
mateo21@mateo21-desktop:/usr/games$ cd /home/mateo21/ (brutale)
mateo21@mateo21-desktop:/usr/games$ cd ~ (maligne)
mateo21@mateo21-desktop:/usr/games$ cd (super maligne : cd sans rien)

• Autocomplétion du chemin
L'autocomplétion de chemin fonctionne de la même manière que l'autocomplétion de commande qu'on a vue dans le chapitre précédent : avec la touche Tab
mateo21@mateo21-desktop:~$ cd /usr
mateo21@mateo21-desktop:/usr$ cd ga(+ Tab)
mateo21@mateo21-desktop:/usr$ cd games/
Appuyer 2 fois sur Tab s'il y a plusieurs éléments proposés
mateo21@mateo21-desktop:/usr$ cd l
lib/   local/
mateo21@mateo21-desktop:/usr$ cd l(o + Tab)cal/

◘ du: taille occupée par les dossiers

• -h : la taille pour les humains
mateo21@mateo21-desktop:~$ du -h
400K    ./.Trash
4,0K    ./.themes

• -a : afficher la taille des dossiers ET des fichiers
mateo21@mateo21-desktop:~$ du -ah
...
8,0K    ./.jedit/settings-backup/abbrevs~5~
24K     ./.jedit/settings-backup/history~1~

• -s : avoir juste le grand total
Pour n'avoir que l'espace total occupé par le dossier et donc ne pas afficher le détail des sous-dossiers, utilisez -s
mateo21@mateo21-desktop:~$ du -sh
81M     .


III) MANIPULER DES FICHIERS

◘ cat & less : afficher un fichier

mateo21@mateo21-desktop:~$ cd /var/log

• cat : afficher tout le fichier
mateo21@mateo21-desktop:/var/log$ cat syslog
Elle est plus adaptée lorsque l'on travaille sur de petits fichiers que sur des gros, car dans un cas comme celui-là, on n'a pas le temps de lire tout ce qui s'affiche à l'écran.
On notera quand même le paramètre -n qui permet d'afficher les numéros de ligne :
mateo21@mateo21-desktop:/var/log$ cat -n syslog

• less : afficher le fichier page par page
La grosse différence entre less et cat, c'est que less affiche progressivement le contenu du fichier, page par page. Ça laisse le temps de le lire dans la console.
mateo21@mateo21-desktop:/var/log$ less syslog
Comment lire la suite ?

• Les raccourcis basiques indispensables
○ Espace : affiche la suite du fichier. fait défiler le fichier vers le bas d'un « écran » de console.
○ Entrée : affiche la ligne suivante. 
○ d : affiche les onze lignes suivantes (soit une moitié d'écran). 
○ b : retourne en arrière d'un écran. (ou touche Page Up)
○ y : retourne d'une ligne en arrière (ou flèche haut)
○ u : retourne en arrière d'une moitié d'écran (onze lignes).
○ q : arrête la lecture du fichier. Cela met fin à la commande less.

• Quelques raccourcis plus avancés
○ = : indique où vous en êtes dans le fichier (numéro des lignes affichées et pourcentage)
○ h : affiche l'aide (toutes les commandes que je vous apprends ici, je les tire de là). Tapez q pour sortir de l'aide.
○ / : tapez / suivi du texte que vous recherchez pour lancer le mode recherche. Faites Entrée pour valider.
Expressions régulières acceptées.
○ n : après avoir fait une recherche avec/, la touche n vous permet d'aller à la prochaine occurrence de votre recherche. 
○ N : pareil que n, mais pour revenir en arrière.

◘ head & tail : afficher le début et la fin d'un fichier

• head : afficher le début du fichier
La commande head affiche seulement les premières lignes du fichier. Elle ne permet pas de se déplacer dans le fichier comme less, mais juste de récupérer les premières lignes.

mateo21@mateo21-desktop:/var/log$ head syslog
Nov 14 00:44:23 mateo21-desktop syslogd 1.4.1#21ubuntu3: restart.

Paramètres : -n, suivi d'un nombre. Il permet d'afficher le nombre de lignes que vous voulez. Par exemple, si vous ne voulez que les trois premières lignes, tapez :
mateo21@mateo21-desktop:/var/log$ head -n 3 syslog
Nov 14 00:44:23 mateo21-desktop syslogd 1.4.1#21ubuntu3: restart.
Nov 14 00:44:23 mateo21-desktop anacron[6725]: Job `cron.daily' terminated
Nov 14 00:44:23 mateo21-desktop anacron[6725]: Normal exit (1 job 

• tail : afficher la fin du fichier
la commande tail vous renvoie la fin du fichier, donc les dernières lignes.
mateo21@mateo21-desktop:/var/log$ tail syslog
On peut là encore utiliser -n suivi d'un nombre pour afficher les $x$ dernières lignes :
mateo21@mateo21-desktop:/var/log$ tail -n 3 syslog
Autre paramètre : -f
Ce paramètre magique ordonne à tail de « suivre » la fin du fichier au fur et à mesure de son évolution.
Ctrl + C pour arrêter la commande tail

(!) Ctrl + C est utilisable dans la plupart des programmes console pour demander leur arrêt.

Par défaut, tail -f recherche les nouveaux changements dans le fichier toutes les secondes. Si vous voulez, vous pouvez rajouter le paramètre -s suivi d'un nombre. Par exemple,tail -f -s 3 syslog recherchera les changements toutes les trois secondes (plutôt que toutes les secondes)

◘ touch & mkdir : créer des fichiers et dossiers

• touch : créer un fichier
La commande attend un paramètre : le nom du fichier à créer.
mateo21@mateo21-desktop:/var/log$ cd
mateo21@mateo21-desktop:~$
mateo21@mateo21-desktop:~$ touch fichierbidon
mateo21@mateo21-desktop:~$ ls -F
Desktop/    Examples@     images/  log/      Musique/  tutos/
Documents/  fichierbidon  Images/  Modèles/  Public/   Vidéos/
Vous pouvez créer un fichier de l'extension que vous voulez :
mateo21@mateo21-desktop:~$ touch autrefichierbidon.txt
Vous pouvez créer plusieurs fichiers en une seule commande :
touch fichierbidon autrefichierbidon.txt
Et si je veux que mon fichier contienne un espace, je fais comment ?
touch "Fichier bidon"

• mkdir : créer un dossier
mkdir mondossier autredossier
Il y a un paramètre utile avec mkdir : -p. Il sert à créer tous les dossiers intermédiaires. 
mkdir -p animaux/vertebres/chat
… créera le dossier animaux, puis à l'intérieur le sous-dossier vertebres, puis à l'intérieur encore le sous-dossier chat !

◘ cp & mv : copier et déplacer un fichier

• cp : copier un fichier
cp fichierbidon fichiercopie
Le premier paramètre est le nom du fichier à copier, le second le nom de la copie du fichier à créer.
En faisant cela, on aura donc deux fichiers identiques dans le même répertoire : fichierbidon et fichiercopie.

○ Copier dans un autre dossier :
si je veux copier fichierbidon dans le sous-dossier mondossier que j'ai créé tout à l'heure :
cp fichierbidon mondossier/
Le fichier fichierbidon sera copié dans mondossier sous le même nom
Si vous voulez copier fichierbidon dans mondossier sous un autre nom, faites comme ceci :
cp fichierbidon mondossier/fichiercopie
cp fichierbidon /var/log/
… copierafichierbidondans le dossier/var/log.

○ Copier des dossiers :
Avec l'option-R, vous pouvez copier un dossier, ainsi que tous les sous-dossiers et fichiers qu'il
contient !
cp -R animaux autresanimaux
… cela aura pour effet de copier animaux ainsi que tous ses sous-dossiers sous le nom autresanimaux.

○ Utiliser le joker*
Le symbole * est appelé joker, ou encore wildcard en anglais sous Linux.
Il vous permet de copier par exemple tous les fichiers image .jpg dans un sous-dossier :
cp *.jpg mondossier/
Pour copier tous les fichiers dont le nom commence par « so » :
cp so* mondossier/

• mv : déplacer un fichier
2 utilités :
- déplacer un fichier (ou un dossier) ;
- renommer un fichier (ou un dossier).

○ Déplacer un fichier 
mv fichierbidon mondossier/
Vous pouvez déplacer des dossiers aussi simplement :
mv animaux/ mondossier/
Vous pouvez aussi utiliser les jokers :
mv *.jpg mondossier/

○ Renommer un fichier 
mv fichierbidon superfichier
… renommera fichierbidon en superfichier. Après cette commande, fichierbidon n'existe plus, il a été renommé.

○ Déplacer et renommer un fichier à la fois
Vous pouvez aussi déplacer fichierbidon dans mondossier tout en lui affectant un nouveau nom :
mv fichierbidon mondossier/superfichier

◘ rm : supprimer des fichiers et dossiers

(!) il n'existe pas de corbeille dans la console de Linux :
le fichier est directement supprimé sans possibilité de récupération !

• rm : supprimer un fichier
rm fichierbidon
rm fichierbidon fichiercopie

○ -i : demander confirmation
mateo21@mateo21-desktop:~$ rm -i fichierbidon
rm: détruire fichier régulier vide `fichierbidon'?
o/y ou n + Entrée

○ -f : forcer la suppression, quoi qu'il arrive (à utiliser le plus rarement possible)
rm -f fichierbidon

○ -v : dis-moi ce que tu fais, petit cachotier
Le paramètre -v (Verbose, verbeux en anglais, c'est-à-dire « parler beaucoup »)
est un paramètre que l'on retrouve dans beaucoup de commandes sous Linux.
Il permet de demander à la commande de dire ce qu'elle est en train de faire.
mateo21@mateo21-desktop:~$ rm -v fichierbidon fichiercopie
détruit `fichierbidon'
détruit `fichiercopie'

○ -r : supprimer un dossier et son contenu
rm -r animaux/
… supprime le dossier animaux ainsi que tout ce qu'il contenait (sous-dossiers vertebres et chat)
Aussi : rmdir. La grosse différence avec rm -r, c'est que rmdir ne peut supprimer un dossier que s'il est vide

○ rm et le joker de la mort (qui tue)
NON NON NON NE FAITES JAMAIS CA !!! => rm -rf /*
rm : commande la suppression ;
-r : supprime de manière récursive tous les fichiers et dossiers ;
-f : force la suppression sans demander la moindre confirmation ;
/* : supprime tous les fichiers et dossiers qui se trouvent à la racine (/) quel que soit leur nom (joker *)

◘ ln : créer des liens entre fichiers

Elle permet de créer des raccourcis. On peut créer deux types de liens :
- des liens physiques ;
- des liens symboliques.

○ Créer des liens physiques 
Plus rarement utilisé que le lien symbolique
Un lien physique permet d'avoir deux noms de fichiers qui partagent exactement le même contenu,
c'est-à-dire le même inode
Ainsi, que vous passiez par fichier1 ou par fichier2, vous modifiez exactement le même contenu.
mkdir tests
cd tests
touch fichier1
ln fichier1 fichier2
mateo21@mateo21-desktop:~/tests$ ls -l
total 0
-rw-r--r-- 2 mateo21 mateo21 0 2008-07-31 13:55 fichier1
-rw-r--r-- 2 mateo21 mateo21 0 2008-07-31 13:55 fichier2
La seconde colonne de la liste (qui indique « 2 » pour chacun des fichiers) correspond au nombre de fichiers qui
partagent le même inode.
Le seul moyen de vérifier que ces fichiers partagent le même contenu, c'est de faire ls -i pour afficher les numéros
d'inode correspondants et de vérifier que ces deux fichiers sont associés au même inode.

○ Créer des liens symboliques 
Le principe du lien symbolique est que l'on crée un lien vers un autre nom de fichier. 
Cette fois, on pointe vers le nom de fichier et non vers l'inode directement (figure suivante).
rm fichier2
Créons maintenant un nouveau fichier2, cette fois sous forme de lien symbolique.
On utilise là encore la commande ln, mais avec le paramètre -s (s comme symbolique) :
ln -s fichier1 fichier2
mateo21@mateo21-desktop:~/tests$ ls -l
total 0
-rw-r--r-- 1 mateo21 mateo21 0 2008-07-31 13:55 fichier1
lrwxrwxrwx 1 mateo21 mateo21 8 2008-07-31 14:15 fichier2 -> fichier1
-> la toute première lettre de la seconde ligne est un l (comme link, c'est-à-dire lien) ;
-> tout à la fin de la seconde ligne, une flèche montre clairement que fichier2 pointe vers fichier1.

Si vous supprimez fichier2, il ne se passe rien de mal. 
Par contre, si vous supprimez fichier1, fichier2 pointera vers un
fichier qui n'existe plus. 
Le lien symbolique sera cassé et ne servira donc plus à rien. On parle de « lien mort » ;
D'autre part, l'avantage des liens symboliques est qu'ils fonctionnent aussi sur des répertoires,
contrairement aux liens physiques.